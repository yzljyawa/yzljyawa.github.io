
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>使用 FFT/NTT 进行字符串匹配 | yzljyのBlog</title>
    <meta name="author" content="yzljy" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/yzljy.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>YZLJYのBLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;首页</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;关于</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;归档</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;分类</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;标签</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;YZLJYのBLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">首页</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">关于</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">归档</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">分类</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">标签</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>使用 FFT/NTT 进行字符串匹配</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/5/20
        </span>
        
        <span class="category">
            <a href="/categories/OI/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                OI
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/" style="color: #979a9a">
                    多项式
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p>我们一般进行字符串匹配，有两种方法：KMP 和 Hash。<br />
我们这里介绍一种新的方法，FFT。</p>
<p>前置知识：</p>
<ul>
<li>FFT/NTT</li>
</ul>
<p>不会的可以看看我的博客？<a
target="_blank" rel="noopener" href="https://yzljyawa.github.io/OI/FFT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">这里</a></p>
<hr />
<p>我们现在有两个由小写英文字母组成的字符串 <span
class="math inline">\(A\)</span> 和 <span
class="math inline">\(B\)</span>，现在 <span
class="math inline">\(A\)</span> 串是模式串，我们在 <span
class="math inline">\(B\)</span> 中进行匹配。<br />
（<span class="math inline">\(A\)</span> 的长度为 <span
class="math inline">\(m\)</span>，<span class="math inline">\(B\)</span>
的长度为 <span class="math inline">\(n\)</span>。） 常见的做法是
KMP，它可以在 <span class="math inline">\(O(n+m)\)</span>
的时间复杂度下完成这么一个问题，非常优秀。<br />
但是我们现在的串中含有通配符 <code>*</code>，思考一下，会发现 KMP
是无法解决的。</p>
<h2 id="普通的字符串匹配">普通的字符串匹配</h2>
<p>我们定义一种差异函数 <span
class="math inline">\(f(x,y)\)</span>，表示 <span
class="math inline">\(A_x\)</span> 与 <span
class="math inline">\(B_y\)</span> 之间的“距离”。也就是对应的 ASCII
码的差值。很显然，若 <span class="math inline">\(f\)</span> 函数的值为
<span
class="math inline">\(0\)</span>，说明这两个位置是同一个字符。<br />
那么我们对于 <span class="math inline">\(B\)</span> 上的某个长度为 <span
class="math inline">\(m\)</span> 的子串，可以定义一个函数 <span
class="math inline">\(P(x)\)</span>，表示以 <span
class="math inline">\(B_{x}\)</span> 结尾的长度为 <span
class="math inline">\(m\)</span> 的子串与 <span
class="math inline">\(A\)</span> 的差异值。那么有 <span
class="math inline">\(P_{x}=\sum_{i=x-m+1}^{x}f(i-x+m-1,i)\)</span>。也很显然，<span
class="math inline">\(P(x)\)</span> 如果为 <span
class="math inline">\(0\)</span>，说明 <span
class="math inline">\(B\)</span> 的子串 <span
class="math inline">\(B[x-m+1,x]\)</span> 与 <span
class="math inline">\(A\)</span> 是完全匹配的。</p>
<p>但是我们会发现一个问题。<br />
对于串 <code>AB</code> 和 串
<code>BA</code>，根据我们的函数计算出来，差异值为 <span
class="math inline">\(0\)</span>。<br />
为什么？<br />
因为正负性。<br />
取消正负性有两种方法，一是绝对值，二是平方。显然绝对值是不好处理的。所以我们平方一下。</p>
<p><span class="math display">\[
P_{x}=\sum_{i=x-m+1}^{x}[f(i-x+m-1,i)]^2
\]</span></p>
<p>把 <span class="math inline">\(f\)</span> 函数展开，可以得到：</p>
<p><span class="math display">\[
P_{x}=\sum_{i=x-m+1}^{x}(A_{i-x+m-1}-B_{i})^2
\]</span></p>
<p>如果我们直接将平方展开，会变成这样：</p>
<p><span class="math display">\[
P_{x}=\sum_{i=x-m+1}^{x}\left(A_{i-x+m-1}^2+B_{i}^2-2A_{i-x+m-1}B_{i}\right)
\]</span></p>
<p>看不出来什么东西。</p>
<p>试试将求和符号丢进每一项看看。</p>
<p><span class="math display">\[
P_{x}=\sum_{i=x-m+1}^{x}A_{i-x+m-1}^2+\sum_{i=x-m+1}^{x}B_{i}^2-2\sum_{i=x-m+1}^{x}A_{i-x+m-1}B_{i}
\]</span></p>
<p>发现第一项是一个定值，也就是 <span
class="math inline">\(\sum_{i=0}^{m-1}A_{i}^{2}\)</span>。<br />
第二项对于 <span class="math inline">\(B_{i}^{2}\)</span>
进行一个前缀和预处理，也可以快速算出。<br />
第三项看着有点麻烦。我们发现 <span
class="math inline">\(i-x+m-1-i\)</span> 是一个定值 <span
class="math inline">\(-x+m-1\)</span>，而如果我们能将
<strong>差为定值</strong>，变成
<strong>和为定值</strong>，那就是一个卷积的形式了！<br />
怎么变成 <strong>和为定值</strong> 呢？很简单，我们将 <span
class="math inline">\(A\)</span> 串进行翻转操作得到一个新的串 <span
class="math inline">\(S\)</span>，易得 <span
class="math inline">\(S_{i}=A_{m-i-1},A_{i}=S_{m-i-1}\)</span>，于是最后一项就变成了
<span
class="math inline">\(S_{m-(i-x+m-1)-1}B_{i}=S_{x-i}B_{i}\)</span>，这下和就是一个定值
<span class="math inline">\(x\)</span> 了！我们便可以使用 FFT/NTT
来加速这一过程。</p>
<p>至此，我们使用 FFT/NTT，在 <span class="math inline">\(O(n\log
n)\)</span> 的时间复杂度下完成了普通的字符串匹配。</p>
<h2 id="带通配符的字符串匹配">带通配符的字符串匹配</h2>
<p>这才是我们要讲的重点，也就是这道题：<br />
<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4173">Luogu P4173
残缺的字符串</a></p>
<p>这道题中，我们的字符串 <span class="math inline">\(A\)</span> 和
<span class="math inline">\(B\)</span>
都多了一种字符：通配符。此时我们先前的差异函数 <span
class="math inline">\(f(x,y)\)</span> 显然就存在问题了，因为
<code>*</code> 的 ASCII 值是 <span class="math inline">\(42\)</span>，而
<span class="math inline">\(a\)</span> 的 ASCII 值则是 <span
class="math inline">\(97\)</span>。相减显然会出现问题。<br />
我们知道，当 <span class="math inline">\(f\)</span> 函数值为 <span
class="math inline">\(0\)</span> 时表示相同，那么我们不妨令
<code>*</code> 对应 <span class="math inline">\(0\)</span>
这个值，其他的 <code>a</code> 到 <code>b</code> 则表示 <span
class="math inline">\(1\)</span> 到 <span
class="math inline">\(26\)</span>，那么我们新的差异函数 <span
class="math inline">\(f(x,y)\)</span> 就应该等于 <span
class="math inline">\(A_{x}B_{y}(A_{x}-B_{y})^2\)</span>。<br />
同理：</p>
<p><span class="math display">\[
P_{x}=\sum_{i=x-m+1}^{x}A_{i-x+m-1}B_{i}(A_{i-x+m-1}-B_{i})^2
\]</span></p>
<p>我们不妨还是将 <span class="math inline">\(A\)</span>
串翻转一下得到串 <span
class="math inline">\(S\)</span>，并且将式子展开化简。</p>
<p><span class="math display">\[
\begin{aligned}
    P_{x}&amp;=\sum_{i=x-m+1}^{x}S_{x-i}B_{i}(S_{x-i}-B_{i})^2\\
         &amp;=\sum_{i=x-m+1}^{x}S_{x-i}^3B_{i}+S_{x-i}B_{i}^3-2S_{x-i}^2B_{i}^2\\
         &amp;=\sum_{i=x-m+1}^{x}S_{x-i}^3B_{i}+\sum_{i=x-m+1}^{x}S_{x-i}B_{i}^3-2\sum_{i=x-m+1}^{x}S_{x-i}^2B_{i}^2\\
\end{aligned}
\]</span></p>
<p>不难发现每一项都是卷积的形式，直接 FFT/NTT 做就行了。<br />
那么就结束啦！</p>
<p>使用 FFT 的参考代码：</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        
    </div>
    <div class='spoiler-content'>
        <pre class="cpp"><code>// Problem: P4173 残缺的字符串
// Contest: Luogu
// URL: https://www.luogu.com.cn/problem/P4173
// Memory Limit: 128 MB
// Time Limit: 2000 ms
// 
// Powered by CP Editor (https://cpeditor.org)

#include&lt;bits/stdc++.h&gt;
using namespace std;
typedef complex&lt;long double&gt; fs;
const int MAXN=2e6+10;
const int mod1=1e9+7;
const int mod2=998244353;
const int inf_int=0x7f7f7f7f;
const long long inf_long=0x7f7f7f7f7f7f7f7f;
const long double pi=acos(-1);
const long double eps=1e-5;
char Buf[1&lt;&lt;23],*P1=Buf,*P2=Buf;
#define getchar() (P1==P2&amp;&amp;(P2=(P1=Buf)+fread(Buf,1,1&lt;&lt;23,stdin),P1==P2)?EOF:*P1++)
template&lt;typename type&gt;
inline void read(type &amp;x){
    x=0;
    bool f=false;
    char ch=getchar();
    while(ch&lt;&#39;0&#39;||ch&gt;&#39;9&#39;) f|=ch==&#39;-&#39;,ch=getchar();
    while(ch&gt;=&#39;0&#39;&amp;&amp;ch&lt;=&#39;9&#39;) x=x*10+(ch^48),ch=getchar();
    if(f) x=-x;
}
template&lt;typename type,typename... args&gt;
inline void read(type &amp;x,args&amp;... y){
    read(x),read(y...);
}

int N,M,BIT,rev[MAXN],a[MAXN],b[MAXN];
fs A[MAXN],B[MAXN],C[MAXN];
string AA,BB;

void FFT(fs *s,int opt,int bit){
    int n=(1&lt;&lt;bit);
    for(int i=0;i&lt;n;i++) rev[i]=(rev[i&gt;&gt;1]&gt;&gt;1)|((i&amp;1)&lt;&lt;bit-1);
    for(int i=0;i&lt;n;i++) if(i&lt;rev[i]) swap(s[i],s[rev[i]]);
    for(int i=2;i&lt;=n;i*=2){
        fs omega=fs(cos(2*pi/i),sin(opt*2*pi/i));
        for(int j=0;j&lt;n;j+=i){
            fs z=fs(1,0);
            for(int k=j;k&lt;j+i/2;k++){
                fs p=s[k],q=z*s[k+i/2];
                s[k]=p+q;
                s[k+i/2]=p-q;
                z*=omega;
            }
        }
    }
    if(opt==-1) for(int i=0;i&lt;n;i++) s[i].real(s[i].real()/n);
}

signed main(){
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin&gt;&gt;N&gt;&gt;M&gt;&gt;AA&gt;&gt;BB;
    for(int l=0,r=N-1;l&lt;r;l++,r--) swap(AA[l],AA[r]);
    for(int i=0;i&lt;N;i++) a[i]=(AA[i]==&#39;*&#39;?0:AA[i]-&#39;a&#39;+1);
    for(int i=0;i&lt;M;i++) b[i]=(BB[i]==&#39;*&#39;?0:BB[i]-&#39;a&#39;+1);
    while((1&lt;&lt;BIT)&lt;N+M-1) BIT++;
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) A[i]=fs(a[i]*a[i]*a[i],0);
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) B[i]=fs(b[i],0);
    FFT(A,1,BIT);FFT(B,1,BIT);
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) C[i]+=A[i]*B[i];
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) A[i]=fs(a[i],0);
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) B[i]=fs(b[i]*b[i]*b[i],0);
    FFT(A,1,BIT);FFT(B,1,BIT);
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) C[i]+=A[i]*B[i];
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) A[i]=fs(a[i]*a[i],0);
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) B[i]=fs(b[i]*b[i],0);
    FFT(A,1,BIT);FFT(B,1,BIT);
    for(int i=0;i&lt;(1&lt;&lt;BIT);i++) C[i]-=fs(2,0)*A[i]*B[i];
    FFT(C,-1,BIT);
    int ans=0;
    for(int i=N-1;i&lt;M;i++) if(fabs(C[i].real())&lt;=eps) ans++;
    cout&lt;&lt;ans&lt;&lt;endl;
    for(int i=N-1;i&lt;M;i++) if(fabs(C[i].real())&lt;=eps) cout&lt;&lt;i-N+2&lt;&lt;&quot; &quot;;
    return 0;
}</code></pre>

    </div>
</div>
<p>使用 NTT 的参考代码（from：<a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/76508">Untitled_unrevised</a>）</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        
    </div>
    <div class='spoiler-content'>
        <pre class="cpp"><code>#include &lt;algorithm&gt;
#include &lt;bit&gt;
#include &lt;cstdint&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;vector&gt;

using std::cin;
using std::cout;
using std::string;
using std::swap;
using std::transform;
using std::vector;

using u32 = std::uint32_t;
using u64 = std::uint64_t;

constexpr u64 P = 998&#39;244&#39;353;

template&lt;class Grp, class Exp, class Ty&gt;
constexpr Ty pow(Grp base, Exp exp, Ty init) {
    for(; exp; exp &gt;&gt;= 1, base *= base)
        if(exp &amp; 1)
            init *= base;
    return init;
}

template&lt;class Grp, class Exp, class Ty&gt;
constexpr Ty&amp; pow_assign(Grp base, Exp exp, Ty &amp;init) {
    for(; exp; exp &gt;&gt;= 1, base *= base)
        if(exp &amp; 1)
            init *= base;
    return init;
}

struct Fp {
    
    u32 x;

    constexpr Fp(u32 value = 0) : x(value) {}

    constexpr Fp&amp; operator+=(const Fp &amp;other) {
        x += other.x;
        if(x &gt;= P) x -= P;
        return *this;
    }
    constexpr Fp&amp; operator-=(const Fp &amp;other) {
        if(x &lt; other.x) x += P;
        x -= other.x;
        return *this;
    }
    constexpr Fp&amp; operator*=(const Fp &amp;other) {
        x = u64(x) * other.x % P;
        return *this;
    }
    constexpr Fp&amp; operator/=(const Fp &amp;other) {
        return pow_assign(other, P - 2, *this);
    }

    constexpr friend Fp operator+(Fp lhs, const Fp &amp;rhs) { return lhs += rhs; }
    constexpr friend Fp operator-(Fp lhs, const Fp &amp;rhs) { return lhs -= rhs; }
    constexpr friend Fp operator*(Fp lhs, const Fp &amp;rhs) { return lhs *= rhs; }
    constexpr friend Fp operator/(Fp lhs, const Fp &amp;rhs) { return lhs /= rhs; }
};

constexpr Fp prim(3);
constexpr Fp co_prim = Fp(1) / prim;

template&lt;class RanIt&gt;
void FFT(RanIt vec, int loglen, bool type) {

    // static_assert(std::is_same_v&lt;RanIt::velue_type, Fp&gt;);

    size_t len = 1ull &lt;&lt; loglen;

    vector&lt;size_t&gt; bitrev(len);
    for(size_t idx = 0; idx &lt; len; ++idx) {
        bitrev[idx] = (bitrev[idx &gt;&gt; 1] &gt;&gt; 1) | ((idx &amp; 1) &lt;&lt; (loglen - 1));
        if(idx &lt; bitrev[idx]) {
            swap(vec[idx], vec[bitrev[idx]]);
        }
    }

    for(int logseg = 0; logseg &lt; loglen; ++logseg) {

        Fp omega = pow(
            type ? co_prim : prim,
            (P - 1) &gt;&gt; (logseg + 1),
            Fp(1)
        );
        size_t seg = 1ull &lt;&lt; logseg;
        
        for(RanIt lspan = vec; lspan != vec + len; lspan += (seg + seg)) {
            Fp phi = Fp(1);
            RanIt rspan = lspan + seg;
            for(size_t off = 0; off &lt; seg; ++off) {
                Fp g  = lspan[off];
                Fp hw = rspan[off] * phi;
                lspan[off] = g + hw;
                rspan[off] = g - hw;
                phi *= omega;
            }
        }
    }

    if(type) {
        Fp invN = Fp(1) / Fp(len);
        for(size_t idx = 0; idx &lt; len; ++idx)
            vec[idx] *= invN;
    }
}

int main() {

    cin.tie(nullptr)-&gt;sync_with_stdio(false);

    size_t m, n;
    cin &gt;&gt; m &gt;&gt; n;

    string a, b;
    cin &gt;&gt; a &gt;&gt; b;

    int logext = std::bit_width(n - 1);
    size_t extn = 1ull &lt;&lt; logext;

    vector&lt;Fp&gt; A, B;

    A.reserve(extn);
    for(char ch : a) {
        A.emplace_back(ch == &#39;*&#39; ? 0 : ch - 96);
    }
    std::reverse(A.begin(), A.end());
    A.resize(extn);

    B.reserve(extn);
    for(char ch : b) {
        B.emplace_back(ch == &#39;*&#39; ? 0 : ch - 96);
    }
    B.resize(extn);

    vector&lt;Fp&gt; Acube(extn), Asqr(extn);
    vector&lt;Fp&gt; Bcube(extn), Bsqr(extn);

    transform(A.begin(), A.end(), Asqr.begin(), [](const Fp &amp;x) {
        return x * x;
    });
    transform(B.begin(), B.end(), Bsqr.begin(), [](const Fp &amp;x) {
        return x * x;
    });
    transform(A.begin(), A.end(), Acube.begin(), [](const Fp &amp;x) {
        return x * x * x;
    });
    transform(B.begin(), B.end(), Bcube.begin(), [](const Fp &amp;x) {
        return x * x * x;
    });

    FFT(A.begin(), logext, false);
    FFT(Asqr.begin(), logext, false);
    FFT(Acube.begin(), logext, false);

    FFT(B.begin(), logext, false);
    FFT(Bsqr.begin(), logext, false);
    FFT(Bcube.begin(), logext, false);

    vector&lt;Fp&gt; C(extn);
    for(size_t i = 0; i &lt; extn; ++i) {
        C[i] = Acube[i] * B[i] - Fp(2) * Asqr[i] * Bsqr[i] + A[i] * Bcube[i];
    }
    FFT(C.begin(), logext, true);

    vector&lt;size_t&gt; res;
    for(size_t i = m - 1; i &lt; n; ++i) {
        if(C[i].x == 0) {
            res.push_back(i - (m - 1) + 1);
        }
    }

    cout &lt;&lt; res.size() &lt;&lt; &#39;\n&#39;;
    for(size_t x : res)
        cout &lt;&lt; x &lt;&lt; &#39; &#39;;
    
    return 0;
}</code></pre>

    </div>
</div>
<p>最后放一道课后习题：<a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF528D">CF528D Fuzzy
Search</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2025 yzljyのBlog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;yzljy
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    
<script
    src="https://giscus.app/client.js"
    data-repo="yzljyawa/yzljyawa.github.io"
    data-repo-id="R_kgDOMbAUfA"
    data-category="Announcements"
    data-category-id="DIC_kwDOMbAUfM4CiQYe"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





    
</body>
</html>
